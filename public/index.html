<script>
  const chatBox = document.getElementById("chat");
  const userInput = document.getElementById("userInput");
  const sendBtn = document.getElementById("sendBtn");

  // Keep track of conversation
  let history = [];

  async function sendMessage() {
    const message = userInput.value.trim();
    if (!message) return;

    // Show user message
    chatBox.innerHTML += `<p><strong>user:</strong> ${message}</p>`;
    history.push({ role: "user", content: message });
    userInput.value = "";

    try {
      const response = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ history }),
      });

      const data = await response.json();
      if (data.reply) {
        chatBox.innerHTML += `<p><strong>bot:</strong> ${data.reply}</p>`;
        history.push({ role: "assistant", content: data.reply });
      } else {
        chatBox.innerHTML += `<p><strong>bot:</strong> (No response)</p>`;
      }
    } catch (error) {
      chatBox.innerHTML += `<p><strong>bot:</strong> Error: ${error.message}</p>`;
    }
  }

  sendBtn.addEventListener("click", sendMessage);
  userInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") sendMessage();
  });
</script>
